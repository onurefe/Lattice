#include "polyreg.h"
#include "matrix.h"

/* Private definitions -----------------------------------------------------*/
#define NUM_OF_SAMPLES_1 100
#define POLY_DEGREE 2

/* Private variables -------------------------------------------------------*/
// Polynomial fitting Matrix (X^T * X)^-1 X^T from degree 2, 100 samples with equal intervals
//from 1.9 to 2.4. Generated with the python script.
static const float Deg2Sa100From1d9to2d4[] =
    {
        5.51586838e+00, 5.19239721e+00, 4.87542322e+00,
        4.56494643e+00, 4.26096683e+00, 3.96348441e+00,
        3.67249919e+00, 3.38801115e+00, 3.11002030e+00,
        2.83852664e+00, 2.57353017e+00, 2.31503089e+00,
        2.06302880e+00, 1.81752390e+00, 1.57851618e+00,
        1.34600566e+00, 1.11999232e+00, 9.00476175e-01,
        6.87457217e-01, 4.80935448e-01, 2.80910867e-01,
        8.73834762e-02, -9.96467260e-02, -2.80179739e-01,
        -4.54215564e-01, -6.21754199e-01, -7.82795645e-01,
        -9.37339902e-01, -1.08538697e+00, -1.22693685e+00,
        -1.36198954e+00, -1.49054504e+00, -1.61260335e+00,
        -1.72816448e+00, -1.83722841e+00, -1.93979516e+00,
        -2.03586471e+00, -2.12543708e+00, -2.20851226e+00,
        -2.28509025e+00, -2.35517105e+00, -2.41875466e+00,
        -2.47584109e+00, -2.52643032e+00, -2.57052236e+00,
        -2.60811722e+00, -2.63921489e+00, -2.66381536e+00,
        -2.68191865e+00, -2.69352475e+00, -2.69863366e+00,
        -2.69724539e+00, -2.68935992e+00, -2.67497726e+00,
        -2.65409742e+00, -2.62672038e+00, -2.59284616e+00,
        -2.55247475e+00, -2.50560615e+00, -2.45224036e+00,
        -2.39237738e+00, -2.32601721e+00, -2.25315985e+00,
        -2.17380531e+00, -2.08795357e+00, -1.99560465e+00,
        -1.89675854e+00, -1.79141524e+00, -1.67957474e+00,
        -1.56123707e+00, -1.43640220e+00, -1.30507014e+00,
        -1.16724089e+00, -1.02291446e+00, -8.72090832e-01,
        -7.14770019e-01, -5.50952017e-01, -3.80636825e-01,
        -2.03824445e-01, -2.05148753e-02, 1.69291883e-01,
        3.65595830e-01, 5.68396967e-01, 7.77695292e-01,
        9.93490806e-01, 1.21578351e+00, 1.44457340e+00,
        1.67986048e+00, 1.92164475e+00, 2.16992621e+00,
        2.42470486e+00, 2.68598070e+00, 2.95375372e+00,
        3.22802394e+00, 3.50879134e+00, 3.79605594e+00,
        4.08981772e+00, 4.39007669e+00, 4.69683285e+00,
        5.01008620e+00,
        -5.02668608e+00, -4.72679092e+00, -4.43296756e+00,
        -4.14521603e+00, -3.86353631e+00, -3.58792840e+00,
        -3.31839231e+00, -3.05492803e+00, -2.79753557e+00,
        -2.54621492e+00, -2.30096609e+00, -2.06178907e+00,
        -1.82868387e+00, -1.60165048e+00, -1.38068891e+00,
        -1.16579915e+00, -9.56981208e-01, -7.54235080e-01,
        -5.57560767e-01, -3.66958269e-01, -1.82427585e-01,
        -3.96871620e-03, 1.68418338e-01, 3.34733577e-01,
        4.94977001e-01, 6.49148610e-01, 7.97248404e-01,
        9.39276384e-01, 1.07523255e+00, 1.20511690e+00,
        1.32892943e+00, 1.44667015e+00, 1.55833906e+00,
        1.66393615e+00, 1.76346142e+00, 1.85691489e+00,
        1.94429653e+00, 2.02560636e+00, 2.10084438e+00,
        2.17001058e+00, 2.23310497e+00, 2.29012754e+00,
        2.34107829e+00, 2.38595723e+00, 2.42476436e+00,
        2.45749967e+00, 2.48416317e+00, 2.50475485e+00,
        2.51927472e+00, 2.52772277e+00, 2.53009901e+00,
        2.52640343e+00, 2.51663604e+00, 2.50079683e+00,
        2.47888581e+00, 2.45090298e+00, 2.41684832e+00,
        2.37672186e+00, 2.33052358e+00, 2.27825348e+00,
        2.21991157e+00, 2.15549784e+00, 2.08501230e+00,
        2.00845495e+00, 1.92582578e+00, 1.83712479e+00,
        1.74235199e+00, 1.64150738e+00, 1.53459095e+00,
        1.42160270e+00, 1.30254264e+00, 1.17741077e+00,
        1.04620708e+00, 9.08931573e-01, 7.65584254e-01,
        6.16165120e-01, 4.60674171e-01, 2.99111407e-01,
        1.31476828e-01, -4.22295651e-02, -2.22007773e-01,
        -4.07857797e-01, -5.99779635e-01, -7.97773288e-01,
        -1.00183876e+00, -1.21197604e+00, -1.42818514e+00,
        -1.65046605e+00, -1.87881878e+00, -2.11324332e+00,
        -2.35373967e+00, -2.60030785e+00, -2.85294783e+00,
        -3.11165963e+00, -3.37644325e+00, -3.64729868e+00,
        -3.92422593e+00, -4.20722499e+00, -4.49629587e+00,
        -4.79143856e+00,
        1.14164240e+00, 1.07245195e+00, 1.00467355e+00,
        9.38307204e-01, 8.73352906e-01, 8.09810657e-01,
        7.47680458e-01, 6.86962310e-01, 6.27656211e-01,
        5.69762162e-01, 5.13280164e-01, 4.58210215e-01,
        4.04552316e-01, 3.52306467e-01, 3.01472668e-01,
        2.52050919e-01, 2.04041220e-01, 1.57443572e-01,
        1.12257973e-01, 6.84844235e-02, 2.61229244e-02,
        -1.48265247e-02, -5.43639238e-02, -9.24892729e-02,
        -1.29202572e-01, -1.64503821e-01, -1.98393021e-01,
        -2.30870170e-01, -2.61935269e-01, -2.91588319e-01,
        -3.19829318e-01, -3.46658267e-01, -3.72075167e-01,
        -3.96080016e-01, -4.18672816e-01, -4.39853565e-01,
        -4.59622265e-01, -4.77978914e-01, -4.94923514e-01,
        -5.10456064e-01, -5.24576563e-01, -5.37285013e-01,
        -5.48581413e-01, -5.58465763e-01, -5.66938062e-01,
        -5.73998312e-01, -5.79646512e-01, -5.83882662e-01,
        -5.86706762e-01, -5.88118812e-01, -5.88118812e-01,
        -5.86706762e-01, -5.83882662e-01, -5.79646512e-01,
        -5.73998312e-01, -5.66938062e-01, -5.58465763e-01,
        -5.48581413e-01, -5.37285013e-01, -5.24576563e-01,
        -5.10456064e-01, -4.94923514e-01, -4.77978914e-01,
        -4.59622265e-01, -4.39853565e-01, -4.18672816e-01,
        -3.96080016e-01, -3.72075167e-01, -3.46658267e-01,
        -3.19829318e-01, -2.91588319e-01, -2.61935269e-01,
        -2.30870170e-01, -1.98393021e-01, -1.64503821e-01,
        -1.29202572e-01, -9.24892730e-02, -5.43639238e-02,
        -1.48265247e-02, 2.61229244e-02, 6.84844235e-02,
        1.12257973e-01, 1.57443572e-01, 2.04041220e-01,
        2.52050919e-01, 3.01472668e-01, 3.52306467e-01,
        4.04552316e-01, 4.58210215e-01, 5.13280164e-01,
        5.69762162e-01, 6.27656211e-01, 6.86962310e-01,
        7.47680458e-01, 8.09810657e-01, 8.73352906e-01,
        9.38307204e-01, 1.00467355e+00, 1.07245195e+00,
        1.14164240e+00

};

/* Exported functions ------------------------------------------------------*/
void Polyreg_Fit1(float *samples, float *coefficients)
{
    Matrix_t C, Y, A;
    C.arr = (float *)Deg2Sa100From1d9to2d4;
    C.m = POLY_DEGREE + 1;
    C.n = NUM_OF_SAMPLES_1;

    Y.arr = samples;
    Y.m = NUM_OF_SAMPLES_1;
    Y.n = 1;

    A.arr = coefficients;

    Matrix_Multiply(&C, &Y, &A);
}